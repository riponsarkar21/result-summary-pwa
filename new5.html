<!-- version: 5:
space adjusted of section summery
narrow accordion wide reducing padding to place in on vh -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Bag Stock</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.json" />
  <style>
:root{
  --bg:#0b1220; --card:#141b2d; --muted:#9aa3b2; --text:#e5e7eb;
  --accent:#22c55e; --ring:rgba(255,255,255,.12); --border:rgba(255,255,255,.08);
  --shadow:0 10px 30px rgba(0,0,0,.35); --radius:10px; --pad:14px; --gap:12px;
  --bm-2ply:#ffffff; --gold-2ply:#d4af37; --gold-1ply:#e7d289;
  --am-2ply:#2f3646; --am-1ply:#4b5563; --am-1ply-mes:#9ca3af;
}
*{box-sizing:border-box}
html,body{height:1dvh}
body{
  margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
  background:radial-gradient(1200px 670px at 20% -20%, #1f2937 0%, #0b1220 40%, #060a12 100%), var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  /* min-width: 360px; */
}
.container{max-width:350px;margin:0 auto;padding:5px 10px 100px;}

header.appbar{
  position:fixed; top:0; z-index:50;
  backdrop-filter:saturate(1.2) blur(16px);
  background:linear-gradient(180deg, rgba(6,10,18,.7), rgba(6,10,18,.35) 60%, rgba(6,10,18,0));
  border-bottom:1px solid var(--border);
  height: 150px;
  min-width: 350px;
}
.appbar .title{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 14px;gap:10px;
}
.appbar .title h1{font-size:18px;margin:0;font-weight:700}
.badge{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--muted)}

.expand-btn{
  background:linear-gradient(180deg, #3b82f6, #2563eb);
  border:none;color:#fff;font-size:13px;font-weight:600;
  padding:8px 14px;border-radius:8px;cursor:pointer;
  box-shadow:0 4px 10px rgba(37,99,235,.3);transition:all .2s;
}
.expand-btn:hover{background:linear-gradient(180deg,#2563eb,#1d4ed8)}
.expand-btn:active{transform:translateY(1px)}

.form-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;padding:5px 10px 10px}
.field{display:flex;flex-direction:column;gap:6px}
.label{font-size:12px;color:var(--muted)}
.input,select{
  width:100%;padding:12px;border-radius:8px;
  background:rgba(255,255,255,.04);color:var(--text);
  border:1px solid var(--border);outline:none;
}
.summary{width: 340px;display:flex;align-items:center;justify-content:space-between;gap:10px;margin:2px 10px;padding:2px 4px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid var(--border)}
.summary .label-grandtotal{text-align: right; font-size: 14; font-weight: 700; min-width: 90px;}
.summary .value{font-size:22px;font-weight:800;text-align:right}

.accordion{display:flex;flex-direction:column;gap:10px;margin: 150px 2px 0 -4px; min-width: 340px;}
.card{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
.card .head{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 10px;border-bottom:1px solid var(--border)}
.card .head h2{margin:0;font-size:16px}
/* .brand-chip{font-size:11px;font-weight:700;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06)} */
.toggle{appearance:none;width:26px;height:26px;border-radius:8px;border:1px solid var(--border);display:grid;place-content:center;background:rgba(255,255,255,.06);cursor:pointer}
.toggle:after{content:"\25BC";font-size:12px}
.card[open] .toggle:after{content:"\25B2"}

.brand-strip{height:5px}
.brand-bm-2ply{background:var(--bm-2ply)}
.brand-gold-2ply{background:var(--gold-2ply)}
.brand-gold-1ply{background:var(--gold-1ply)}
.brand-am-2ply{background:var(--am-2ply)}
.brand-am-1ply{background:var(--am-1ply)}
.brand-am-1ply-mes{background:var(--am-1ply-mes)}

/* .body{padding: 5px;display:grid;gap:0px;width:340px ;} */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.calc-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:end}
.pill{padding:10px 12px;border:1px solid var(--border);border-radius:8px;background:rgba(255,255,255,.04);color:var(--muted);font-size:12px}
.total{font-weight:800;color:var(--text)}

.fab{position:fixed;right:10px;bottom:46px;z-index:60;background:linear-gradient(180deg,#34d399,#10b981);color:#04120b;font-weight:900;padding:14px 18px;border-radius:16px;border:0;box-shadow:0 12px 30px rgba(16,185,129,.35);display:flex;align-items:center;gap:10px;cursor:pointer}
.footer{position:fixed;left:0;right:0;bottom:0;background:rgba(6,10,18,.8);backdrop-filter:blur(12px);border-top:1px solid var(--border);padding:10px 14px;display:flex;justify-content:space-between;gap:10px}
.footer .info{font-size:12px;color:var(--muted)}

    
.input-row{
  display:flex;
  align-items:center;
  margin-bottom:8px;
  min-width: 330px;
  border: #3d3d3d solid 1px;
  border-radius: 8px;
  padding: 0 0 0 5px;

}
.input-row .label{
  min-width:75px;   
  font-size:12px;   
  color:var(--muted);
}
.input-row .input{width: 50px;flex:1;/* border:#10b981 solid 1px; */margin: 0 1px;}
.input-row .total{background:rgba(255,255,255,.04);font-weight:700;margin-right: -1px;text-align: right;padding-right: 5px;}

.shift-selection-dropdown{background-color: var(--bg);color: var(--text);}


  </style>
</head>
<body>
<header class="appbar">
  <div class="title">
    <div style="display:flex;align-items:center;gap:10px">
      <h1>Bag Stock</h1>
      <span class="badge">Packing</span>
    </div>
    <button id="toggleAllBtn" class="expand-btn" type="button">Expand All</button>
  </div>

  <section class="summary">
    <div class="form-row">
      <div class="field">
        <label class="label" for="date">Date</label>
        <input id="date" class="input" type="date" />
      </div>
      <div class="field">
        <label class="label" for="shift">Shift</label>
        <select id="shift" class="shift-selection-dropdown">
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
          <!-- <option value="ALL">ALL</option> -->
        </select>
      </div>
      <div class="field">
        <label class="label-grandtotal">Grand Total</label>
        <div id="grandTotal" class="value">0</div>
      </div>
    </div>
  </section>
</header>

<main class="container">
  <section class="accordion" id="accordion"></section>
</main>

<button class="fab" id="saveBtn" type="button">ðŸ’¾ Save</button>
<footer class="footer">
  <div class="info">Data is stored locally on this device.</div>
  <div class="info" id="status">Unsaved</div>
</footer>

<script>
const BRANDS = [
  { key:"bm_2ply",      name:"BM 2Ply",       strip:"brand-bm-2ply" },
  { key:"am_2ply",      name:"AM 2Ply",       strip:"brand-am-2ply" },
  { key:"am_1ply",      name:"AM 1Ply",       strip:"brand-am-1ply" },
  { key:"am_1ply_mes",  name:"AM 1Ply MES",   strip:"brand-am-1ply-mes" },
  { key:"gold_2ply",    name:"Gold 2Ply",     strip:"brand-gold-2ply" },
  { key:"gold_1ply",    name:"Gold 1Ply",     strip:"brand-gold-1ply" },
  { key:"gold_1ply_mes",name:"Gold 1Ply MES", strip:"brand-gold-1ply" }
];

const accordion = document.getElementById('accordion');

function brandCardTemplate({ key, name, strip }) {
  // Fixed row labels
  const ROWS = [
    "Store",
    "Packer-1",
    "Packer-2",
    "May-21",
    "Without Seal",
    "Old Bag",
    "New Bag",
    "Faulty"
  ];

  // Build horizontal rows
  const rowsHtml = ROWS.map((row, i) => `
    <div class="input-row">
      <label class="label" for="${key}_${i}_bundle">${row} :</label>
      <input id="${key}_${i}_bundle" class="input qty bundle" type="number" placeholder="Bundle" min="0">
      <input id="${key}_${i}_loose"  class="input qty loose"  type="number" placeholder="Loose"  min="0">
      <input id="${key}_${i}_total"  class="input total"       type="number" placeholder="Total"  readonly>
    </div>
  `).join("");

  return `
    <details class="card" id="${key}">
      <div class="brand-strip ${strip}"></div>
      <summary class="head" onclick="event.preventDefault(); this.parentElement.toggleAttribute('open'); this.parentElement.dispatchEvent(new Event('toggle')); ">
        <h2>${name}</h2>
        <div style="display:flex;align-items:center;gap:8px">
          <strong><span class="brand-chip" id="chip_${key}">Total: 0</strong></span>
          <button class="toggle" aria-label="Toggle ${name}"></button>
        </div>
      </summary>
      <div class="body">
        ${rowsHtml}
      </div>
    </details>
  `;
}



// Render cards
accordion.innerHTML = BRANDS.map(brandCardTemplate).join('');

const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
const byId=(id)=>document.getElementById(id);

// function calcBrand(key){
//   const bundle = parseInt(byId(`${key}_bundle`).value||0,10);
//   const loose  = parseInt(byId(`${key}_loose`).value||0,10);
//   const total = bundle*200 + loose;
//   byId(`${key}_total`).textContent=total;
//   byId(`chip_${key}`).textContent=`Total: ${total}`;
//   return total;
// }
function calcBrand(key){
  let brandSum = 0;
  // there are 8 rows, index 0..7
  for(let i=0;i<8;i++){
    const bundle = parseInt(document.getElementById(`${key}_${i}_bundle`)?.value || 0, 10);
    const loose  = parseInt(document.getElementById(`${key}_${i}_loose`)?.value  || 0, 10);
    const rowTotal = bundle*200 + loose;
    const totalEl = document.getElementById(`${key}_${i}_total`);
    if(totalEl) totalEl.value = rowTotal;   // fill the Total input
    brandSum += rowTotal;
  }
  const chip = document.getElementById(`chip_${key}`);
  if(chip) chip.textContent = `Total: ${brandSum}`;
  return brandSum;
}

function calcGrand(){
  const grand = BRANDS.reduce((s,b)=>s+calcBrand(b.key),0);
  byId('grandTotal').textContent=grand;
  return grand;
}

function wireInputs(){
  $$('.qty').forEach(el=>el.addEventListener('input',()=>{calcGrand();setDirty();}));
  byId('date').addEventListener('change',()=>{updateSummaryDate();setDirty();});
  byId('shift').addEventListener('change',setDirty);
}
function updateSummaryDate(){
  const d=byId('date').value; 
  if(d) new Date(d).toDateString();
}

const KEY='bag_stock_form_v1';
function save(){
  const data={date:byId('date').value,shift:byId('shift').value,
    brands:Object.fromEntries(BRANDS.map(b=>[
      b.key,{
        store:byId(`${b.key}_store`).value,
        bundle:byId(`${b.key}_bundle`).value,
        loose:byId(`${b.key}_loose`).value,
        open:document.getElementById(b.key).hasAttribute('open')
      }
    ]))
  };
  localStorage.setItem(KEY,JSON.stringify(data));
  byId('status').textContent='Saved';
}
function load(){
  const raw=localStorage.getItem(KEY);
  if(!raw) return;
  try{
    const data=JSON.parse(raw);
    if(data.date) byId('date').value=data.date;
    if(data.shift) byId('shift').value=data.shift;
    for(const b of BRANDS){
      const v=data.brands?.[b.key]; if(!v) continue;
      byId(`${b.key}_store`).value=v.store??'';
      byId(`${b.key}_bundle`).value=v.bundle??0;
      byId(`${b.key}_loose`).value=v.loose??0;
      const card=document.getElementById(b.key);
      if(v.open) card.setAttribute('open',''); else card.removeAttribute('open');
    }
    updateToggleBtn();
  }catch(e){console.warn('Load failed',e);}
}
function setDirty(){byId('status').textContent='Unsaved';}

// Expand/Collapse button
const toggleAllBtn=document.getElementById('toggleAllBtn');
function setAll(open){$$('#accordion details.card').forEach(d=>open?d.setAttribute('open',''):d.removeAttribute('open'));}
function updateToggleBtn(){
  const anyClosed=$$('#accordion details.card').some(d=>!d.hasAttribute('open'));
  toggleAllBtn.textContent=anyClosed?'Expand All':'Collapse All';
}
accordion.addEventListener('toggle',updateToggleBtn,true);
toggleAllBtn.addEventListener('click',()=>{
  const shouldExpand=toggleAllBtn.textContent.includes('Expand');
  setAll(shouldExpand); updateToggleBtn(); setDirty();
});

// Init
load(); wireInputs(); calcGrand();
if(!byId('date').value){
  const t=new Date(); byId('date').value=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
}
updateToggleBtn();

byId('saveBtn').addEventListener('click',save);
</script>
</body>
</html>
